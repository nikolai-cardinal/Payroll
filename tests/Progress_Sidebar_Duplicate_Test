// Edge-case test: showProgressSidebar should not create duplicate dialogs within 5-minute window.
/* global CacheService, SpreadsheetApp, Logger */

function testSidebarDuplicatePrevention() {
  if (typeof showProgressSidebar !== 'function') {
    throw new Error('showProgressSidebar not defined');
  }

  // Ensure fresh state
  var cache = CacheService.getDocumentCache();
  cache.remove('progress_sidebar_open');

  // Stub UI
  var openCount = 0;
  var uiStub = {
    showModelessDialog: function () { openCount++; },
  };
  var ssApp = SpreadsheetApp;
  var originalGetUi = ssApp.getUi;
  ssApp.getUi = function () { return uiStub; };

  try {
    // First call should open dialog
    showProgressSidebar();
    // Second call immediately should not open another dialog
    showProgressSidebar();

    if (openCount !== 1) {
      throw new Error('Expected 1 sidebar open, got ' + openCount);
    }
    Logger.log('âœ“ Duplicate sidebar prevention works');
  } finally {
    ssApp.getUi = originalGetUi; // restore
    cache.remove('progress_sidebar_open');
  }
} 